(function(i,n){typeof exports=="object"&&typeof module!="undefined"?n(exports):typeof define=="function"&&define.amd?define(["exports"],n):(i=typeof globalThis!="undefined"?globalThis:i||self,n(i.fpblocker={}))})(this,function(i){"use strict";var de=Object.defineProperty,fe=Object.defineProperties;var be=Object.getOwnPropertyDescriptors;var N=Object.getOwnPropertySymbols;var me=Object.prototype.hasOwnProperty,ke=Object.prototype.propertyIsEnumerable;var R=(i,n,o)=>n in i?de(i,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):i[n]=o,d=(i,n)=>{for(var o in n||(n={}))me.call(n,o)&&R(i,o,n[o]);if(N)for(var o of N(n))ke.call(n,o)&&R(i,o,n[o]);return i},h=(i,n)=>fe(i,be(n));var _=(i,n,o)=>(R(i,typeof n!="symbol"?n+"":n,o),o);var L=(i,n,o)=>new Promise((g,y)=>{var f=u=>{try{l(o.next(u))}catch(k){y(k)}},w=u=>{try{l(o.throw(u))}catch(k){y(k)}},l=u=>u.done?g(u.value):Promise.resolve(u.value).then(f,w);l((o=o.apply(i,n)).next())});var q;const n=new Set,o={blockedScripts:new Array,blockedIFrames:new Array,blockedImages:new Array,blockedNetworkRequests:new Array},g=()=>{var s;let e=[];try{e=((s=new Error().stack)==null?void 0:s.split(`
`).slice(2))||[]}catch(t){}return e},y=()=>({scripts:o.blockedScripts.map(e=>e.origSrc),iframes:o.blockedIFrames.map(e=>e.origSrc),images:o.blockedImages.map(e=>e.origSrc),networkRequests:o.blockedNetworkRequests}),f="freshpaint/blocked";let w=[];const l=e=>{if(!e)return!1;const s=e.toString();return s.length===0?!1:w.some(t=>t.test(s))},u=e=>!e||e.toString().length===0?!1:!l(e),k=(e,s,t)=>{s!==f&&(o.blockedScripts.push({node:e,origSrc:t,origType:s}),e.removeAttribute("src"),e.setAttribute("data-src",t),e.setAttribute("type",f),W(e))},j=(e,s,t)=>{const r=e.cloneNode(!0);r.setAttribute("src",t),r.setAttribute("type",s||"text/javascript"),r.removeAttribute("data-src");const c=e.parentElement;c?(c.removeChild(e),c.appendChild(r)):document.head.appendChild(r)},F=(e,s)=>{console.warn("Blocking and hiding IFrame for",s);const t=e.style.display;o.blockedIFrames.push({node:e,origSrc:s,origDisplay:t}),e.removeAttribute("src"),e.setAttribute("data-src",s),e.style.display="none"},X=(e,s,t)=>{e.setAttribute("src",s),e.removeAttribute("data-src"),t?e.style.display=t:e.style.display=""},O=(e,s)=>{console.warn("Blocking and hiding Image for",s);const t=e.style.display;o.blockedImages.push({node:e,origSrc:s,origDisplay:t}),e.removeAttribute("src"),e.setAttribute("data-src",s),e.style.display="none"},K=(e,s,t)=>{e.setAttribute("src",s),e.removeAttribute("data-src"),t?e.style.display=t:e.style.display=""},I=()=>{w=Array.from(n).map(e=>new RegExp(e))},M=()=>{const e=o.blockedScripts.filter(({origSrc:s})=>u(s));for(const{node:s,origType:t,origSrc:r}of e)j(s,t,r);o.blockedScripts=o.blockedScripts.filter(s=>!e.includes(s))},G=()=>{const e=o.blockedImages.filter(({origSrc:s})=>u(s));for(const{node:s,origSrc:t,origDisplay:r}of e)K(s,t,r);o.blockedImages=o.blockedImages.filter(s=>!e.includes(s))},V=()=>{const e=o.blockedIFrames.filter(({origSrc:s})=>u(s));for(const{node:s,origSrc:t,origDisplay:r}of e)X(s,t,r);o.blockedIFrames=o.blockedIFrames.filter(s=>!e.includes(s))},W=e=>{const s=t=>{e.getAttribute("type")===f&&t.preventDefault(),e.removeEventListener("beforescriptexecute",s)};e.addEventListener("beforescriptexecute",s)},J=(e,s)=>{if(!s.__SV){try{let t,r;const c=window.location,p=c.hash,a=function(m,B){return t=m.match(new RegExp(B+"=([^&]*)")),t?t[1]:null};p&&a(p,"fpState")&&(r=JSON.parse(decodeURIComponent(a(p,"fpState"))),r.action==="fpeditor"&&(window.sessionStorage.setItem("_fpcehash",p),history.replaceState(r.desiredHash||"",e.title,c.pathname+c.search)))}catch(t){}s.__loaded=!1,s.config=!1,s.__SV=2,window.freshpaint=new Proxy(s,{get(t,r){return t[r]!==void 0?t[r]:r==="init"?function(c,p,a){t._i||(t._i=[]),t._i.push([c,p||{},a||"freshpaint"])}:function(...c){const p=[r,...c];return t.push(p),new Proxy(p,{get(a,m){return a[m]?a[m]:function(...B){a.length=0,a.push([r,...c]),a.push([m,...B])}}})}}})}},Y="https://perfalytics.com/static/js/freshpaint.js",z=()=>{J(window.document,window.freshpaint||[]),Q()},Q=()=>{var t;const e=document.createElement("script");e.type="text/javascript",e.async=!0,typeof window.FRESHPAINT_CUSTOM_LIB_URL!="undefined"?e.src=window.FRESHPAINT_CUSTOM_LIB_URL:e.src=Y;const s=document.getElementsByTagName("script")[0];s?(t=s.parentNode)==null||t.insertBefore(e,s):document.head.appendChild(e)},{fetch:S}=window,A=XMLHttpRequest,E=(q=navigator.sendBeacon)==null?void 0:q.bind(navigator);class Z extends A{constructor(){super(...arguments);_(this,"_url","");_(this,"_method","")}open(t,r,c,p,a){this._url=r,this._method=t,super.open(t,r,c,p,a)}send(t){if(l(this._url.toString())){console.warn("Blocking send:",this._url.toString());const r=g();o.blockedNetworkRequests.push({api:"XHR",method:this._method,url:this._url.toString(),initiator:r});return}super.send(t)}}const $=()=>L(this,null,function*(){window.fetch=(e,s)=>L(this,null,function*(){if(l(e.toString())){console.warn("Intercepting:",e.toString());const t=g();return o.blockedNetworkRequests.push({api:"Fetch",method:(s==null?void 0:s.method)||"GET",url:e.toString(),initiator:t}),Response.error()}return yield S(e,s)}),XMLHttpRequest=Z,navigator.sendBeacon=(e,s)=>{if(l(e.toString())){console.warn("Intercepting sendBeacon:",e.toString());const t=g();return o.blockedNetworkRequests.push({api:"sendBeacon",method:"POST",url:e.toString(),initiator:t}),!1}return E(e,s)}}),ee=()=>{S&&(window.fetch=S),A&&(XMLHttpRequest=A),E&&(navigator.sendBeacon=E)},P=document.createElement,H=Image;let T=!1;const te=()=>{console.warn("FPBlocker - Unpatched DOM createElement"),T=!1,document.createElement=P,Image=H},se=e=>{T||(console.warn("FPBlocker - Patching DOM createElement"),T=!0,document.createElement=function(s,t){const r=P.bind(document)(s,t);if(!("src"in r))return r;try{if(r instanceof HTMLScriptElement&&e.blockScripts)re(r);else if(r instanceof HTMLIFrameElement&&e.blockIFrames)ce(r);else if(r instanceof HTMLImageElement&&e.blockImages)v(r);else return r}catch(c){console.warn("Unable to prevent script execution for script src ",r.src||r.getAttribute("data-src"),`.
`,'A likely cause would be because you are using a third-party browser extension that monkey patches the "document.createElement" function.')}return r},e.blockImages&&(Image=oe))},re=e=>{const s={src:Object.getOwnPropertyDescriptor(HTMLScriptElement.prototype,"src"),type:Object.getOwnPropertyDescriptor(HTMLScriptElement.prototype,"type")};Object.defineProperties(e,{src:h(d({},s.src),{set(t){var r,c,p,a;if(l(t)){const m=(c=(r=s.type)==null?void 0:r.get)==null?void 0:c.call(this);k(this,m,t)}else(a=(p=s.src)==null?void 0:p.set)==null||a.call(this,t)}}),type:h(d({},s.type),{get(){var r,c;const t=(c=(r=s.type)==null?void 0:r.get)==null?void 0:c.call(this);return t===f||l(this.src)?null:t},set(t){var r,c;this.getAttribute("type")===f&&(l(this.getAttribute("data-src"))||l(this.src))||(c=(r=s.type)==null?void 0:r.set)==null||c.call(this,t)}})}),e.setAttribute=function(t,r){t==="type"||t==="src"?e[t]=r:HTMLScriptElement.prototype.setAttribute.call(e,t,r)}},ce=e=>{const s={src:Object.getOwnPropertyDescriptor(HTMLIFrameElement.prototype,"src")};Object.defineProperties(e,{src:h(d({},s.src),{set(t){var r,c;l(t)?F(this,t):(c=(r=s.src)==null?void 0:r.set)==null||c.call(this,t)}})}),e.setAttribute=function(t,r){t==="src"?e[t]=r:HTMLIFrameElement.prototype.setAttribute.call(e,t,r)}},v=e=>{const s={src:Object.getOwnPropertyDescriptor(HTMLImageElement.prototype,"src")};Object.defineProperties(e,{src:h(d({},s.src),{set(t){var r,c;l(t)?O(e,t):(c=(r=s.src)==null?void 0:r.set)==null||c.call(e,t)}})}),e.setAttribute=function(t,r){t==="src"?this.src=r:HTMLImageElement.prototype.setAttribute.call(this,t,r)}};class oe extends H{constructor(s,t){super(s,t),v(this)}}const ne=e=>{const s=t=>{for(const r of t)for(const c of r.addedNodes)c.tagName==="SCRIPT"&&c.getAttribute("type")!==f&&e.blockScripts?c.src&&l(c.src)&&(c.src||c.getAttribute("data-src"),c.getAttribute("type"),k(c,c.getAttribute("type"),c.src)):c.tagName==="IFRAME"&&e.blockIFrames?c.src&&l(c.src)&&(c.src||c.getAttribute("data-src"),F(c,c.src)):c.tagName==="IMG"&&e.blockImages?c.src&&l(c.src)&&(c.src||c.getAttribute("data-src"),O(c,c.src)):c.tagName};return new MutationObserver(s)},ie={blocker:{enabled:!1},web:{enabled:!0}},le={enabled:!0,blockScripts:!0,blockIFrames:!0,blockImages:!0,blocklist:[]},ae={enabled:!0},b=ie;b.blocker=d(d({},le),b.blocker),b.web=d(d({},ae),b.web);const x=ne(b.blocker),D=()=>{const e=b.blocker;e.blocklist&&(C(e.blocklist),$()),se(e),x.observe(document.documentElement,{childList:!0,subtree:!0})},C=e=>{for(const s of e)n.add(s);I()},pe=e=>{for(const s of e)n.delete(s);I(),M()},ue=()=>{n.clear(),I(),M(),G(),V(),te(),x.disconnect(),ee()},U=e=>{e.blocker.enabled&&D(),e.web.enabled&&z()};U(b),window.fpblocker={config:b,initBlocking:D,addToBlocklist:C,removeFromBlocklist:pe,stopBlocking:ue,listBlocked:y},i.main=U,Object.defineProperty(i,Symbol.toStringTag,{value:"Module"})});
